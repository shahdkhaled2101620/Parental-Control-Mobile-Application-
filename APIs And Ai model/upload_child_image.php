<?phprequire_once 'db_connection.php'; // Include the database connection// Check if a file was uploadedif ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_FILES['image'])) {    $file = $_FILES['image'];    // Validate the file    if ($file['error'] !== UPLOAD_ERR_OK) {        echo json_encode(["status" => "error", "message" => "File upload failed."]);        exit;    }    // Ensure the file is an image    $allowed_types = ['image/jpeg', 'image/png', 'image/gif'];    if (!in_array($file['type'], $allowed_types)) {        echo json_encode(["status" => "error", "message" => "Invalid file type. Only JPEG, PNG, and GIF are allowed."]);        exit;    }    // Define the upload directory    $upload_dir = __DIR__ . '/uploads/';    if (!is_dir($upload_dir)) {        mkdir($upload_dir, 0777, true); // Create the directory if it doesn't exist    }    // Generate a unique filename    $file_extension = pathinfo($file['name'], PATHINFO_EXTENSION);    $file_name = uniqid('child_image_', true) . '.' . $file_extension; // e.g., child_image_12345.jpg    $file_path = $upload_dir . $file_name;    // Move the uploaded file to the upload directory    if (move_uploaded_file($file['tmp_name'], $file_path)) {        // Get additional data from the POST request        $child_id = intval($_POST['child_id'] ?? 0); // ID of the child        // Validate input        if (empty($child_id)) {            echo json_encode(["status" => "error", "message" => "Child ID is required."]);            exit;        }        // Update the database with the absolute file path        $absolute_file_path = realpath($file_path); // Get the absolute file system path        $stmt = $conn->prepare("UPDATE Child SET Image_Path = ? WHERE Child_ID = ?");        if (!$stmt) {            echo json_encode(["status" => "error", "message" => "Failed to prepare statement: " . $conn->error]);            exit;        }        $stmt->bind_param("si", $absolute_file_path, $child_id);        if ($stmt->execute()) {            echo json_encode([                "status" => "success",                "message" => "Child image uploaded and database updated successfully.",                "file_path" => $absolute_file_path            ]);        } else {            echo json_encode(["status" => "error", "message" => "Failed to update database: " . $stmt->error]);        }        // Close the statement        $stmt->close();    } else {        echo json_encode(["status" => "error", "message" => "Failed to move uploaded file."]);    }} else {    echo json_encode(["status" => "error", "message" => "No file uploaded."]);}// Close the database connection$conn->close();?>